<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Общая точка на карте</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=ВАШ_API_КЛЮЧ&lang=ru_RU"></script>
    <style>
        #map { width: 100%; height: 100vh; }
        .shared-point { background-color: red; border-radius: 50%; width: 20px; height: 20px; }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let map, placemark;
        let socket = new WebSocket('ws://ваш-сервер.com:8080'); // Замените на ваш WebSocket

        // Инициализация карты
        ymaps.ready(() => {
            map = new ymaps.Map("map", {
                center: [55.76, 37.64],
                zoom: 10
            });

            // Клик по карте → отправка точки на сервер
            map.events.add('click', (e) => {
                const coords = e.get('coords');
                socket.send(JSON.stringify({ lat: coords[0], lng: coords[1] }));
            });
        });

        // Получение новых точек от сервера
        socket.onmessage = (event) => {
            const point = JSON.parse(event.data);
            
            // Обновляем метку на карте
            if (placemark) {
                placemark.geometry.setCoordinates([point.lat, point.lng]);
            } else {
                placemark = new ymaps.Placemark([point.lat, point.lng], {}, {
                    preset: 'islands#redDotIcon'
                });
                map.geoObjects.add(placemark);
            }
        };

        // Закрытие соединения при выходе
        tg.onEvent('viewportChanged', (event) => {
            if (!event.isExpanded) {
                socket.close();
            }
        });
    </script>
</body>
</html>
